<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Text Analysis Example • tune</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../tidyverse-2.css" rel="stylesheet">
<meta property="og:title" content="Text Analysis Example">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-115082821-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html">tune</a>
        <div class="info">
          <span class="partof">part of <a href="https://github.com/tidymodels">tidymodels</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9001</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../articles/getting_started.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/grid.html">Grid Search</a>
    </li>
    <li>
      <a href="../../articles/acquisition_functions.html">Acquisition Functions</a>
    </li>
    <li>
      <a href="../../articles/extras/svm_classification.html">Bayesian Optimization of Classification Model</a>
    </li>
    <li>
      <a href="../../articles/extras/optimizations.html">Optimizations and Parallel Processing</a>
    </li>
    <li>
      <a href="../../articles/extras/text_analysis.html">Text Analysis Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>

      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Text Analysis Example</h1>



      <div class="hidden name"><code>text_analysis.Rmd</code></div>

    </div>



<p>This advanced example shows how to process text data with recipes and use them in a predictive model. It also has an example of extracting information from each model fit for later use.</p>
<p>The data are from Amazon:</p>
<blockquote>
<p>“This dataset consists of reviews of fine foods from amazon. The data span a period of more than 10 years, including all ~500,000 reviews up to October 2012. Reviews include product and user information, ratings, and a plaintext review.”</p>
</blockquote>
<p>A small subset of the data are contained here and are split into a training and test set. The training set sampled 10 products and retained all of their individual reviews. Since the reviews within these products are correlated, we recommend resampling the data using a leave-one-product-out approach. The test set sampled 500 products that were not included in the training set and selected a single review at random for each.</p>
<p>There is a column for the product, a column for the text of the review, and a factor column for a class variable. The outcome is whether the reviewer game the product a five-star rating or not.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidymodels)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tune)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"small_fine_foods"</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">training_data</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; # A tibble: 2,137 x 3</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt;    product    review                                                  score</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;                                                   &lt;fct&gt;</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt;  1 B005HGAV8I I ordered the 35 pack and received two of each flavor,… other</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt;  2 B005HGAV8I I ordered the 35 pack.  Maybe I just got lucky but I h… great</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt;  3 B005HGAV8I "I received the Crazy Cups Flavored Coffee Sampler (pa… great</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt;  4 B005HGAV8I The price isn't too bad, but I guess my expectations w… other</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt;  5 B005HGAV8I The selection was OK, but not great, as it seemed that… other</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt;  6 B005HGAV8I I enjoyed trying all the various flavors.  This was an… great</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt;  7 B005HGAV8I this is a good deal in terms of variety although there… other</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt;  8 B005HGAV8I This is a really great assortment of K-Cups.  I have e… great</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt;  9 B005HGAV8I "This item really shouldn't be listed as a gift pack, … other</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt; 10 B005HGAV8I I don't know if I got lucky with mine, or if it's beca… great</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt; # … with 2,127 more rows</span></a></code></pre></div>
<p>The idea is to process the text data into features and use these features to predict whether the review was five-star or not.</p>
<div id="recipe-and-model-specifications" class="section level2">
<h2 class="hasAnchor">
<a href="#recipe-and-model-specifications" class="anchor"></a>Recipe and Model Specifications</h2>
<p>The data processing steps are:</p>
<ul>
<li><p>create an initial set of features based on simple word/character scores, such as the number of words, URLs and so on; The <a href="https://github.com/mkearney/textfeatures"><code>textfeatures</code></a> will be used for this</p></li>
<li><p>the text is tokenized (i.e. broken into smaller components such as words)</p></li>
<li><p>stop words (such as “the”, “an”, etc.) are removed</p></li>
<li><p>tokens are stemmed to a common root where possible</p></li>
<li><p>tokens are converted to dummy variables via a <a href="https://bookdown.org/max/FES/encoding-predictors-with-many-categories.html">signed, binary hash function</a></p></li>
<li><p>non-token features are optionally transformed to a more symmetric state using a <a href="https://bookdown.org/max/FES/numeric-one-to-one.html">Yeo-Johnson transformation</a></p></li>
<li><p>predictors with a single distinct value are removed</p></li>
<li><p>all predictors are centered and scaled.</p></li>
</ul>
<p>Some of these steps may or may not be good ideas (such as stemming). In this process, the main tuning parameter will be the number of feature hash features to use.</p>
<p>A recipe will be used to implement this. We’ll also need some helper objects. For example, for the Yeo-Johnson transformation, we need to know the initial feature set:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(textfeatures)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">basics &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(textfeatures<span class="op">:::</span>count_functions)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(basics)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; [1] "n_words"    "n_uq_words" "n_charS"    "n_uq_charS" "n_digits"  </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; [6] "n_hashtags"</span></a></code></pre></div>
<p>Also, the implementation of feature hashes does not produce binary values. This small function will help convert the scores to values of -1, 0, or 1:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">binary_hash &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(x <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">-1</span>, x)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>,  <span class="dv">1</span>, x)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  x</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">}</a></code></pre></div>
<p>The recipe is:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(textrecipes)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">pre_proc &lt;-</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw">recipe</span>(score <span class="op">~</span><span class="st"> </span>product <span class="op">+</span><span class="st"> </span>review, <span class="dt">data =</span> training_data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="st">  </span><span class="co"># Do not use the product ID as a predictor</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">  </span><span class="kw">update_role</span>(product, <span class="dt">new_role =</span> <span class="st">"id"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">  </span><span class="co"># Make a copy of the raw text</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">  </span><span class="kw">step_mutate</span>(<span class="dt">review_raw =</span> review) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="st">  </span><span class="co"># Compute the initial features. This removes the `review_raw` column</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/textrecipes/man/step_textfeature.html">step_textfeature</a></span>(review_raw) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="st">  </span><span class="co"># Make the feature names shorter</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="st">  </span><span class="kw">step_rename_at</span>(</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">    <span class="kw">starts_with</span>(<span class="st">"textfeature_"</span>),</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">    <span class="dt">fn =</span> <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"textfeature_review_raw_"</span>, <span class="st">""</span>, .)</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/textrecipes/man/step_tokenize.html">step_tokenize</a></span>(review)  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/textrecipes/man/step_stopwords.html">step_stopwords</a></span>(review) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/textrecipes/man/step_stem.html">step_stem</a></span>(review) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="st">  </span><span class="co"># Here is where the tuning parameter is declared</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/textrecipes/man/step_texthash.html">step_texthash</a></span>(review, <span class="dt">signed =</span> <span class="ot">TRUE</span>, <span class="dt">num_terms =</span> <span class="kw"><a href="../../reference/tune.html">tune</a></span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="st">  </span><span class="co"># Simplify these names</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="st">  </span><span class="kw">step_rename_at</span>(<span class="kw">starts_with</span>(<span class="st">"review_hash"</span>), <span class="dt">fn =</span> <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"review_"</span>, <span class="st">""</span>, .)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="st">  </span><span class="co"># Convert the features from counts to values of -1, 0, or 1</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="st">  </span><span class="kw">step_mutate_at</span>(<span class="kw">starts_with</span>(<span class="st">"hash"</span>), <span class="dt">fn =</span> binary_hash) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="st">  </span><span class="co"># Transform the initial feature set</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="st">  </span><span class="kw">step_YeoJohnson</span>(<span class="kw">one_of</span>(<span class="op">!!</span>basics)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="st">  </span><span class="kw">step_zv</span>(<span class="kw">all_predictors</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="st">  </span><span class="kw">step_normalize</span>(<span class="kw">all_predictors</span>())</a></code></pre></div>
<p>Note that, when objects from the global environment are used, they are injected into the step objects via <code>!!</code>. For some parallel processing technologies, these objects may not be found by the worker processes.</p>
<p>To model these data, a regularized logistic regression model will be used:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">lr_mod &lt;-</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw">logistic_reg</span>(<span class="dt">penalty =</span> <span class="kw"><a href="../../reference/tune.html">tune</a></span>(), <span class="dt">mixture =</span> <span class="kw"><a href="../../reference/tune.html">tune</a></span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">"glmnet"</span>)</a></code></pre></div>
<p>Three tuning parameters should be trained for this data analysis.</p>
</div>
<div id="resampling" class="section level2">
<h2 class="hasAnchor">
<a href="#resampling" class="anchor"></a>Resampling</h2>
<p>To resample these data, recall that</p>
<blockquote>
<p>“The training set sampled 10 products and retained all of their individual reviews.”</p>
</blockquote>
<p>The rate of five-star reviews varies between products. To account for this, grouped-V-fold cross-validation is used. Here, 10 resamples are created that leaves out all of the rows corresponding to a each of the produce IDs. The assessment set for each resample is the held-out product. To do this, the <code>rsample</code> package can be used:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">8935</span>)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">folds &lt;-<span class="st"> </span><span class="kw">group_vfold_cv</span>(training_data, <span class="st">"product"</span>)</a></code></pre></div>
</div>
<div id="grid-search" class="section level2">
<h2 class="hasAnchor">
<a href="#grid-search" class="anchor"></a>Grid Search</h2>
<p>A regular grid is used. For <code>glmnet</code> models, evaluating penalty values is fairly cheap due to the use of the “submodel-trick”. The grid will use 20 penalty values, 5 mixture values, and 6 values for the number of hash features.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">five_star_grid &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">    <span class="dt">penalty =</span> <span class="dv">10</span><span class="op">^</span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">0</span>, <span class="dt">length =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">    <span class="dt">mixture =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    <span class="dt">num_terms =</span> <span class="dv">2</span><span class="op">^</span>(<span class="dv">8</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">  )</a></code></pre></div>
<p>Note that, for each resample, the text processing recipe is only prepped 6 times. This increases the computational efficiency of the analysis by avoiding redundant work.</p>
<p>For illustration, we will save information on the number of predictors by penalty value for each <code>glmnet</code> model. This might help use understand how many features were used across the penalty values. An extraction function is used to do this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">glmnet_vars &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="co"># `df` is the number of model terms for each penalty value</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="kw">tibble</span>(<span class="dt">penalty =</span> x<span class="op">$</span>model<span class="op">$</span>lambda, <span class="dt">num_vars =</span> x<span class="op">$</span>model<span class="op">$</span>df)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">ctrl &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/grid_control.html">grid_control</a></span>(<span class="dt">extract =</span> glmnet_vars)</a></code></pre></div>
<p>Finally, let’s run the grid search:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">roc_scores &lt;-<span class="st"> </span><span class="kw">metric_set</span>(roc_auc)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1559</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">five_star_glmnet &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../../reference/tune_grid.html">tune_grid</a></span>(pre_proc, lr_mod, <span class="dt">rs =</span> folds, <span class="dt">grid =</span> five_star_grid, </a>
<a class="sourceLine" id="cb9-6" data-line-number="6">            <span class="dt">perf =</span> roc_scores, <span class="dt">control =</span> ctrl)</a></code></pre></div>
<p>This took a while to complete. What did the results look like? Let’s get the resampling estimates of the area under the ROC curve for each tuning parameter:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">grid_roc &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(five_star_glmnet) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(mean))</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">grid_roc</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt; # A tibble: 300 x 8</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt;    penalty mixture num_terms .metric .estimator  mean     n std_err</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;      &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;  1  0.0546    0.25      1024 roc_auc binary     0.745    10  0.0153</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt;  2  0.0264    0.5       1024 roc_auc binary     0.743    10  0.0157</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt;  3  0.0379    0.25      1024 roc_auc binary     0.742    10  0.0138</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt;  4  0.0183    0.75      1024 roc_auc binary     0.742    10  0.0158</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt;  5  0.0127    1         1024 roc_auc binary     0.740    10  0.0158</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt;  6  0.0785    0.25      1024 roc_auc binary     0.739    10  0.0157</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt;  7  0.0379    0.5       1024 roc_auc binary     0.739    10  0.0159</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt;  8  0.0183    1         1024 roc_auc binary     0.736    10  0.0161</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt;  9  0.0183    0.5       1024 roc_auc binary     0.736    10  0.0140</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt; 10  0.0264    0.75      1024 roc_auc binary     0.735    10  0.0159</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; # … with 290 more rows</span></a></code></pre></div>
<p>The best results had a fairly high penalty value and focused on the ridge penalty (i.e. no feature selection via the lasso’s L1 penalty). The best solutions also used the largest number of hashing features.</p>
<p>What was the relationship between performance and the tuning parameters?</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">ggplot</span>(grid_roc, <span class="kw">aes</span>(<span class="dt">x =</span> penalty, <span class="dt">y =</span> mean, <span class="dt">col =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(mixture), <span class="dt">group =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(mixture))) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>num_terms) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"top"</span>)</a></code></pre></div>
<p><img src="text_analysis_files/figure-html/grid-plot-1.png" width="768"></p>
<p>There is definitely an effect due to the number of features used<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. The profiles with mixture values greater than zero had steep drop-offs in performance. What’s that about? Those are cases where the lasso penalty is removing too many (and perhaps all) features from the model<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<p>It’s clear from the panels at least 256 features that there are several parameter combinations that have roughly equivalent performance. A case could be made to choose a larger mixture value and less of a penalty to select a more simplistic model that contains fewer predictors. If more experimentation were conducted, a largest set of features should also be considered.</p>
<p>We’ll come back to the extracted <code>glmnet</code> components at the end of this example.</p>
</div>
<div id="directed-search" class="section level2">
<h2 class="hasAnchor">
<a href="#directed-search" class="anchor"></a>Directed Search</h2>
<p>What if we had started with Bayesian optimization? Would a good set of conditions have been found more efficiently?</p>
<p>Let’s pretend that we haven’t seen the grid search results. We’ll initialize the Gaussian process model with five tuning parameter combinations chosen with a space-filling design.</p>
<p>It might be good to use a custom <code>dials</code> object for the number of hash terms. The default object, <code>num_terms()</code>, uses a linear range and tries to set the upper bound of the parameter using the data. Instead, let’s create a parameter set, change the scale to be log2, and define the same range as was used in grid search.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">hash_range &lt;-<span class="st"> </span><span class="kw">num_terms</span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">8</span>, <span class="dv">10</span>), <span class="dt">trans =</span> <span class="kw">log2_trans</span>())</a></code></pre></div>
<p>To use this, we have to merge the recipe and <code>parsnip</code> model object into a workflow:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">five_star_wflow &lt;-</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../../reference/workflow.html">workflow</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../../reference/workflow.html">add_recipe</a></span>(pre_proc) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../../reference/workflow.html">add_model</a></span>(lr_mod)</a></code></pre></div>
<p>Then we can extract and manipulate the corresponding parameter set:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">five_star_set &lt;-</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span>five_star_wflow <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/dials/man/param_set.html">param_set</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/update.html">update</a></span>(<span class="dt">num_terms =</span> hash_range, <span class="dt">penalty =</span> <span class="kw">penalty</span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">0</span>)))</a></code></pre></div>
<p>This is passed to the search function via the <code>param_info</code> argument.</p>
<p>Finally, the initial rounds of search can be biased more towards exploration of the parameter space (as opposed to staying near the current best results). If expected improvement is used as the acquisition function, the trade-off value can be slowly moved from exploration to exploitation over iterations<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. <code>tune</code> has a built-in function called <code><a href="../../reference/expo_decay.html">expo_decay()</a></code> that can help accomplish this:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">trade_off_decay &lt;-<span class="st"> </span><span class="cf">function</span>(iter) {</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  <span class="kw"><a href="../../reference/expo_decay.html">expo_decay</a></span>(iter, <span class="dt">start_val =</span> <span class="fl">.01</span>, <span class="dt">limit_val =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">}</a></code></pre></div>
<p>Using these values, let’s run the search:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">five_star_search &lt;-</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../../reference/tune_Bayes.html">tune_Bayes</a></span>(</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">    five_star_wflow, </a>
<a class="sourceLine" id="cb16-5" data-line-number="5">    <span class="dt">rs =</span> folds,</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">    <span class="dt">param_info =</span> five_star_set,</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">    <span class="dt">initial =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">    <span class="dt">iter =</span> <span class="dv">30</span>,</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">    <span class="dt">perf =</span> roc_scores,</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">    <span class="dt">objective =</span> <span class="kw"><a href="../../reference/prob_improve.html">exp_improve</a></span>(trade_off_decay),</a>
<a class="sourceLine" id="cb16-11" data-line-number="11">    <span class="dt">control =</span> <span class="kw"><a href="../../reference/Bayes_control.html">Bayes_control</a></span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-12" data-line-number="12">  )</a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="co">#&gt; ❯  Generating a set of 5 initial parameter results</span></a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#&gt; ✓ Initialization complete</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co">#&gt; Optimizing roc_auc using the expected improvement with variable trade-off values.</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="co">#&gt; ── Iteration 1 ────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-21" data-line-number="21"><span class="co">#&gt; i Current best:      roc_auc=0.6963 (@iter 0)</span></a>
<a class="sourceLine" id="cb16-22" data-line-number="22"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-23" data-line-number="23"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-24" data-line-number="24"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-25" data-line-number="25"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-26" data-line-number="26"><span class="co">#&gt; i Trade-off value: 0.01</span></a>
<a class="sourceLine" id="cb16-27" data-line-number="27"><span class="co">#&gt; i penalty=0.001, mixture=0.62, num_terms=258</span></a>
<a class="sourceLine" id="cb16-28" data-line-number="28"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-29" data-line-number="29"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-30" data-line-number="30"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.6722 (+/-0.0176)</span></a>
<a class="sourceLine" id="cb16-31" data-line-number="31"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-32" data-line-number="32"><span class="co">#&gt; ── Iteration 2 ────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-33" data-line-number="33"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-34" data-line-number="34"><span class="co">#&gt; i Current best:      roc_auc=0.6963 (@iter 0)</span></a>
<a class="sourceLine" id="cb16-35" data-line-number="35"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-36" data-line-number="36"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-37" data-line-number="37"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-38" data-line-number="38"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-39" data-line-number="39"><span class="co">#&gt; i Trade-off value: 0.007788</span></a>
<a class="sourceLine" id="cb16-40" data-line-number="40"><span class="co">#&gt; i penalty=0.00107, mixture=0.0428, num_terms=1023</span></a>
<a class="sourceLine" id="cb16-41" data-line-number="41"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-42" data-line-number="42"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-43" data-line-number="43"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.6369 (+/-0.0165)</span></a>
<a class="sourceLine" id="cb16-44" data-line-number="44"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-45" data-line-number="45"><span class="co">#&gt; ── Iteration 3 ────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-46" data-line-number="46"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-47" data-line-number="47"><span class="co">#&gt; i Current best:      roc_auc=0.6963 (@iter 0)</span></a>
<a class="sourceLine" id="cb16-48" data-line-number="48"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-49" data-line-number="49"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-50" data-line-number="50"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-51" data-line-number="51"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-52" data-line-number="52"><span class="co">#&gt; i Trade-off value: 0.006065</span></a>
<a class="sourceLine" id="cb16-53" data-line-number="53"><span class="co">#&gt; i penalty=0.963, mixture=0.33, num_terms=352</span></a>
<a class="sourceLine" id="cb16-54" data-line-number="54"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-55" data-line-number="55"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-56" data-line-number="56"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.5</span></a>
<a class="sourceLine" id="cb16-57" data-line-number="57"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-58" data-line-number="58"><span class="co">#&gt; ── Iteration 4 ────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-59" data-line-number="59"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-60" data-line-number="60"><span class="co">#&gt; i Current best:      roc_auc=0.6963 (@iter 0)</span></a>
<a class="sourceLine" id="cb16-61" data-line-number="61"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-62" data-line-number="62"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-63" data-line-number="63"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-64" data-line-number="64"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-65" data-line-number="65"><span class="co">#&gt; i Trade-off value: 0.004724</span></a>
<a class="sourceLine" id="cb16-66" data-line-number="66"><span class="co">#&gt; i penalty=0.00824, mixture=0.976, num_terms=263</span></a>
<a class="sourceLine" id="cb16-67" data-line-number="67"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-68" data-line-number="68"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-69" data-line-number="69"><span class="co">#&gt; ♥ Newest results:    roc_auc=0.7027 (+/-0.0106)</span></a>
<a class="sourceLine" id="cb16-70" data-line-number="70"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-71" data-line-number="71"><span class="co">#&gt; ── Iteration 5 ────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-72" data-line-number="72"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-73" data-line-number="73"><span class="co">#&gt; i Current best:      roc_auc=0.7027 (@iter 4)</span></a>
<a class="sourceLine" id="cb16-74" data-line-number="74"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-75" data-line-number="75"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-76" data-line-number="76"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-77" data-line-number="77"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-78" data-line-number="78"><span class="co">#&gt; i Trade-off value: 0.003679</span></a>
<a class="sourceLine" id="cb16-79" data-line-number="79"><span class="co">#&gt; i penalty=0.0132, mixture=0.72, num_terms=1023</span></a>
<a class="sourceLine" id="cb16-80" data-line-number="80"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-81" data-line-number="81"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-82" data-line-number="82"><span class="co">#&gt; ♥ Newest results:    roc_auc=0.7183 (+/-0.0181)</span></a>
<a class="sourceLine" id="cb16-83" data-line-number="83"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-84" data-line-number="84"><span class="co">#&gt; ── Iteration 6 ────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-85" data-line-number="85"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-86" data-line-number="86"><span class="co">#&gt; i Current best:      roc_auc=0.7183 (@iter 5)</span></a>
<a class="sourceLine" id="cb16-87" data-line-number="87"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-88" data-line-number="88"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-89" data-line-number="89"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-90" data-line-number="90"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-91" data-line-number="91"><span class="co">#&gt; i Trade-off value: 0.002865</span></a>
<a class="sourceLine" id="cb16-92" data-line-number="92"><span class="co">#&gt; i penalty=0.0711, mixture=0.00991, num_terms=856</span></a>
<a class="sourceLine" id="cb16-93" data-line-number="93"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-94" data-line-number="94"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-95" data-line-number="95"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.7133 (+/-0.0158)</span></a>
<a class="sourceLine" id="cb16-96" data-line-number="96"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-97" data-line-number="97"><span class="co">#&gt; ── Iteration 7 ────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-98" data-line-number="98"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-99" data-line-number="99"><span class="co">#&gt; i Current best:      roc_auc=0.7183 (@iter 5)</span></a>
<a class="sourceLine" id="cb16-100" data-line-number="100"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-101" data-line-number="101"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-102" data-line-number="102"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-103" data-line-number="103"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-104" data-line-number="104"><span class="co">#&gt; i Trade-off value: 0.002231</span></a>
<a class="sourceLine" id="cb16-105" data-line-number="105"><span class="co">#&gt; i penalty=0.0325, mixture=0.0176, num_terms=475</span></a>
<a class="sourceLine" id="cb16-106" data-line-number="106"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-107" data-line-number="107"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-108" data-line-number="108"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.6799 (+/-0.019)</span></a>
<a class="sourceLine" id="cb16-109" data-line-number="109"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-110" data-line-number="110"><span class="co">#&gt; ── Iteration 8 ────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-111" data-line-number="111"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-112" data-line-number="112"><span class="co">#&gt; i Current best:      roc_auc=0.7183 (@iter 5)</span></a>
<a class="sourceLine" id="cb16-113" data-line-number="113"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-114" data-line-number="114"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-115" data-line-number="115"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-116" data-line-number="116"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-117" data-line-number="117"><span class="co">#&gt; i Trade-off value: 0.001738</span></a>
<a class="sourceLine" id="cb16-118" data-line-number="118"><span class="co">#&gt; i penalty=0.916, mixture=0.995, num_terms=758</span></a>
<a class="sourceLine" id="cb16-119" data-line-number="119"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-120" data-line-number="120"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-121" data-line-number="121"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.5</span></a>
<a class="sourceLine" id="cb16-122" data-line-number="122"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-123" data-line-number="123"><span class="co">#&gt; ── Iteration 9 ────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-124" data-line-number="124"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-125" data-line-number="125"><span class="co">#&gt; i Current best:      roc_auc=0.7183 (@iter 5)</span></a>
<a class="sourceLine" id="cb16-126" data-line-number="126"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-127" data-line-number="127"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-128" data-line-number="128"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-129" data-line-number="129"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-130" data-line-number="130"><span class="co">#&gt; i Trade-off value: 0.001353</span></a>
<a class="sourceLine" id="cb16-131" data-line-number="131"><span class="co">#&gt; i penalty=0.00369, mixture=0.0567, num_terms=1017</span></a>
<a class="sourceLine" id="cb16-132" data-line-number="132"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-133" data-line-number="133"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-134" data-line-number="134"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.6789 (+/-0.0142)</span></a>
<a class="sourceLine" id="cb16-135" data-line-number="135"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-136" data-line-number="136"><span class="co">#&gt; ── Iteration 10 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-137" data-line-number="137"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-138" data-line-number="138"><span class="co">#&gt; i Current best:      roc_auc=0.7183 (@iter 5)</span></a>
<a class="sourceLine" id="cb16-139" data-line-number="139"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-140" data-line-number="140"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-141" data-line-number="141"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-142" data-line-number="142"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-143" data-line-number="143"><span class="co">#&gt; i Trade-off value: 0.001054</span></a>
<a class="sourceLine" id="cb16-144" data-line-number="144"><span class="co">#&gt; i penalty=0.289, mixture=0.857, num_terms=256</span></a>
<a class="sourceLine" id="cb16-145" data-line-number="145"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-146" data-line-number="146"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-147" data-line-number="147"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.5</span></a>
<a class="sourceLine" id="cb16-148" data-line-number="148"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-149" data-line-number="149"><span class="co">#&gt; ── Iteration 11 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-150" data-line-number="150"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-151" data-line-number="151"><span class="co">#&gt; i Current best:      roc_auc=0.7183 (@iter 5)</span></a>
<a class="sourceLine" id="cb16-152" data-line-number="152"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-153" data-line-number="153"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-154" data-line-number="154"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-155" data-line-number="155"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-156" data-line-number="156"><span class="co">#&gt; i Trade-off value: 0.0008208</span></a>
<a class="sourceLine" id="cb16-157" data-line-number="157"><span class="co">#&gt; i penalty=0.957, mixture=0.00581, num_terms=349</span></a>
<a class="sourceLine" id="cb16-158" data-line-number="158"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-159" data-line-number="159"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-160" data-line-number="160"><span class="co">#&gt; ♥ Newest results:    roc_auc=0.7239 (+/-0.0177)</span></a>
<a class="sourceLine" id="cb16-161" data-line-number="161"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-162" data-line-number="162"><span class="co">#&gt; ── Iteration 12 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-163" data-line-number="163"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-164" data-line-number="164"><span class="co">#&gt; i Current best:      roc_auc=0.7239 (@iter 11)</span></a>
<a class="sourceLine" id="cb16-165" data-line-number="165"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-166" data-line-number="166"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-167" data-line-number="167"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-168" data-line-number="168"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-169" data-line-number="169"><span class="co">#&gt; i Trade-off value: 0.0006393</span></a>
<a class="sourceLine" id="cb16-170" data-line-number="170"><span class="co">#&gt; i penalty=0.00112, mixture=0.996, num_terms=443</span></a>
<a class="sourceLine" id="cb16-171" data-line-number="171"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-172" data-line-number="172"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-173" data-line-number="173"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.6727 (+/-0.0147)</span></a>
<a class="sourceLine" id="cb16-174" data-line-number="174"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-175" data-line-number="175"><span class="co">#&gt; ── Iteration 13 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-176" data-line-number="176"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-177" data-line-number="177"><span class="co">#&gt; i Current best:      roc_auc=0.7239 (@iter 11)</span></a>
<a class="sourceLine" id="cb16-178" data-line-number="178"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-179" data-line-number="179"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-180" data-line-number="180"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-181" data-line-number="181"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-182" data-line-number="182"><span class="co">#&gt; i Trade-off value: 0.0004979</span></a>
<a class="sourceLine" id="cb16-183" data-line-number="183"><span class="co">#&gt; i penalty=0.263, mixture=0.00202, num_terms=346</span></a>
<a class="sourceLine" id="cb16-184" data-line-number="184"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-185" data-line-number="185"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-186" data-line-number="186"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.7076 (+/-0.0124)</span></a>
<a class="sourceLine" id="cb16-187" data-line-number="187"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-188" data-line-number="188"><span class="co">#&gt; ── Iteration 14 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-189" data-line-number="189"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-190" data-line-number="190"><span class="co">#&gt; i Current best:      roc_auc=0.7239 (@iter 11)</span></a>
<a class="sourceLine" id="cb16-191" data-line-number="191"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-192" data-line-number="192"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-193" data-line-number="193"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-194" data-line-number="194"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-195" data-line-number="195"><span class="co">#&gt; i Trade-off value: 0.0003877</span></a>
<a class="sourceLine" id="cb16-196" data-line-number="196"><span class="co">#&gt; i penalty=0.979, mixture=0.707, num_terms=310</span></a>
<a class="sourceLine" id="cb16-197" data-line-number="197"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-198" data-line-number="198"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-199" data-line-number="199"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.5</span></a>
<a class="sourceLine" id="cb16-200" data-line-number="200"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-201" data-line-number="201"><span class="co">#&gt; ── Iteration 15 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-202" data-line-number="202"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-203" data-line-number="203"><span class="co">#&gt; i Current best:      roc_auc=0.7239 (@iter 11)</span></a>
<a class="sourceLine" id="cb16-204" data-line-number="204"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-205" data-line-number="205"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-206" data-line-number="206"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-207" data-line-number="207"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-208" data-line-number="208"><span class="co">#&gt; i Trade-off value: 0.000302</span></a>
<a class="sourceLine" id="cb16-209" data-line-number="209"><span class="co">#&gt; i penalty=0.0521, mixture=0.395, num_terms=511</span></a>
<a class="sourceLine" id="cb16-210" data-line-number="210"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-211" data-line-number="211"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-212" data-line-number="212"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.6897 (+/-0.0168)</span></a>
<a class="sourceLine" id="cb16-213" data-line-number="213"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-214" data-line-number="214"><span class="co">#&gt; ── Iteration 16 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-215" data-line-number="215"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-216" data-line-number="216"><span class="co">#&gt; i Current best:      roc_auc=0.7239 (@iter 11)</span></a>
<a class="sourceLine" id="cb16-217" data-line-number="217"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-218" data-line-number="218"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-219" data-line-number="219"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-220" data-line-number="220"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-221" data-line-number="221"><span class="co">#&gt; i Trade-off value: 0.0002352</span></a>
<a class="sourceLine" id="cb16-222" data-line-number="222"><span class="co">#&gt; i penalty=0.00104, mixture=0.32, num_terms=303</span></a>
<a class="sourceLine" id="cb16-223" data-line-number="223"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-224" data-line-number="224"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-225" data-line-number="225"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.6813 (+/-0.0161)</span></a>
<a class="sourceLine" id="cb16-226" data-line-number="226"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-227" data-line-number="227"><span class="co">#&gt; ── Iteration 17 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-228" data-line-number="228"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-229" data-line-number="229"><span class="co">#&gt; i Current best:      roc_auc=0.7239 (@iter 11)</span></a>
<a class="sourceLine" id="cb16-230" data-line-number="230"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-231" data-line-number="231"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-232" data-line-number="232"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-233" data-line-number="233"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-234" data-line-number="234"><span class="co">#&gt; i Trade-off value: 0.0001832</span></a>
<a class="sourceLine" id="cb16-235" data-line-number="235"><span class="co">#&gt; i penalty=0.12, mixture=0.999, num_terms=276</span></a>
<a class="sourceLine" id="cb16-236" data-line-number="236"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-237" data-line-number="237"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-238" data-line-number="238"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.5</span></a>
<a class="sourceLine" id="cb16-239" data-line-number="239"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-240" data-line-number="240"><span class="co">#&gt; ── Iteration 18 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-241" data-line-number="241"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-242" data-line-number="242"><span class="co">#&gt; i Current best:      roc_auc=0.7239 (@iter 11)</span></a>
<a class="sourceLine" id="cb16-243" data-line-number="243"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-244" data-line-number="244"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-245" data-line-number="245"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-246" data-line-number="246"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-247" data-line-number="247"><span class="co">#&gt; i Trade-off value: 0.0001426</span></a>
<a class="sourceLine" id="cb16-248" data-line-number="248"><span class="co">#&gt; i penalty=0.023, mixture=0.847, num_terms=451</span></a>
<a class="sourceLine" id="cb16-249" data-line-number="249"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-250" data-line-number="250"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-251" data-line-number="251"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.7016 (+/-0.0197)</span></a>
<a class="sourceLine" id="cb16-252" data-line-number="252"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-253" data-line-number="253"><span class="co">#&gt; ── Iteration 19 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-254" data-line-number="254"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-255" data-line-number="255"><span class="co">#&gt; i Current best:      roc_auc=0.7239 (@iter 11)</span></a>
<a class="sourceLine" id="cb16-256" data-line-number="256"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-257" data-line-number="257"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-258" data-line-number="258"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-259" data-line-number="259"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-260" data-line-number="260"><span class="co">#&gt; i Trade-off value: 0.0001111</span></a>
<a class="sourceLine" id="cb16-261" data-line-number="261"><span class="co">#&gt; i penalty=0.0212, mixture=0.606, num_terms=259</span></a>
<a class="sourceLine" id="cb16-262" data-line-number="262"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-263" data-line-number="263"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-264" data-line-number="264"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.7007 (+/-0.0149)</span></a>
<a class="sourceLine" id="cb16-265" data-line-number="265"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-266" data-line-number="266"><span class="co">#&gt; ── Iteration 20 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-267" data-line-number="267"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-268" data-line-number="268"><span class="co">#&gt; i Current best:      roc_auc=0.7239 (@iter 11)</span></a>
<a class="sourceLine" id="cb16-269" data-line-number="269"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-270" data-line-number="270"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-271" data-line-number="271"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-272" data-line-number="272"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-273" data-line-number="273"><span class="co">#&gt; i Trade-off value: 8.652e-05</span></a>
<a class="sourceLine" id="cb16-274" data-line-number="274"><span class="co">#&gt; i penalty=0.00615, mixture=0.598, num_terms=771</span></a>
<a class="sourceLine" id="cb16-275" data-line-number="275"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-276" data-line-number="276"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-277" data-line-number="277"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.7179 (+/-0.00984)</span></a>
<a class="sourceLine" id="cb16-278" data-line-number="278"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-279" data-line-number="279"><span class="co">#&gt; ── Iteration 21 ───────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb16-280" data-line-number="280"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb16-281" data-line-number="281"><span class="co">#&gt; i Current best:      roc_auc=0.7239 (@iter 11)</span></a>
<a class="sourceLine" id="cb16-282" data-line-number="282"><span class="co">#&gt; i Gaussian process model</span></a>
<a class="sourceLine" id="cb16-283" data-line-number="283"><span class="co">#&gt; ✓ Gaussian process model</span></a>
<a class="sourceLine" id="cb16-284" data-line-number="284"><span class="co">#&gt; i Generating 5000 candidates</span></a>
<a class="sourceLine" id="cb16-285" data-line-number="285"><span class="co">#&gt; i Predicted candidates</span></a>
<a class="sourceLine" id="cb16-286" data-line-number="286"><span class="co">#&gt; i Trade-off value: 6.738e-05</span></a>
<a class="sourceLine" id="cb16-287" data-line-number="287"><span class="co">#&gt; i penalty=0.166, mixture=0.329, num_terms=426</span></a>
<a class="sourceLine" id="cb16-288" data-line-number="288"><span class="co">#&gt; i Estimating performance</span></a>
<a class="sourceLine" id="cb16-289" data-line-number="289"><span class="co">#&gt; ✓ Estimating performance</span></a>
<a class="sourceLine" id="cb16-290" data-line-number="290"><span class="co">#&gt; ⓧ Newest results:    roc_auc=0.6492 (+/-0.0205)</span></a>
<a class="sourceLine" id="cb16-291" data-line-number="291"><span class="co">#&gt; Error : Cannot write to fd (system error 9, Bad file descriptor) @client.c:149</span></a>
<a class="sourceLine" id="cb16-292" data-line-number="292"><span class="co">#&gt; ! No improvement for 10 iterations; returning current results.</span></a></code></pre></div>
<p>The results here are not bad but also not spectacular either. The issue is that so many settings are sub-optimal, as shown in the figure above. There are regions where the penalty parameter becomes too large and all of the predictors are removed from the model. These regions are also dependent on the number of terms. There is a fairly narrow ridge<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> where good performance can be achieved. Using more iterations would probably result in the search finding better results.</p>
<p>A plot of model performance versus the search iterations:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="../../reference/plot_perf_vs_iter.html">plot_perf_vs_iter</a></span>(five_star_search)</a></code></pre></div>
<p><img src="text_analysis_files/figure-html/iter-plot-1.png" width="768"></p>
<p>What would we do if we knew about the grid search results? In this case, we would restrict the range for the number of hash features to be larger (especially with more data). We might also restrict the penalty and mixture parameters to have a more restricted upper bound.</p>
</div>
<div id="extracted-results" class="section level2">
<h2 class="hasAnchor">
<a href="#extracted-results" class="anchor"></a>Extracted Results</h2>
<p>Jumping back to the grid search results, let’s examine the results of our <code>extract</code> function. For each <em>fitted model</em>, a tibble was saved that has the relationship between the number of predictors and the penalty value. Let’s look at these results for the best model that had a mixture value greater than zero:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">params &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span>grid_roc <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(mixture <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(penalty, mixture, num_terms)</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">params</a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt;   penalty mixture num_terms</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt; 1  0.0546    0.25      1024</span></a></code></pre></div>
<p>Recall that we saved the <code>glmnet</code> results in a tibble. The column <code>five_star_glmnet$.extracts</code> is a list of tibbles. As an example, the first element of the list is:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">five_star_glmnet<span class="op">$</span>.extracts[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co">#&gt; # A tibble: 15 x 4</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt;    num_terms penalty mixture .extracts         </span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">#&gt;        &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;list&gt;            </span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt;  1       256       1    0    &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co">#&gt;  2       256       1    0.25 &lt;tibble [86 × 2]&gt; </span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt;  3       256       1    0.5  &lt;tibble [81 × 2]&gt; </span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">#&gt;  4       256       1    0.75 &lt;tibble [80 × 2]&gt; </span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt;  5       256       1    1    &lt;tibble [79 × 2]&gt; </span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="co">#&gt;  6       512       1    0    &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="co">#&gt;  7       512       1    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"><span class="co">#&gt;  8       512       1    0.5  &lt;tibble [99 × 2]&gt; </span></a>
<a class="sourceLine" id="cb19-13" data-line-number="13"><span class="co">#&gt;  9       512       1    0.75 &lt;tibble [95 × 2]&gt; </span></a>
<a class="sourceLine" id="cb19-14" data-line-number="14"><span class="co">#&gt; 10       512       1    1    &lt;tibble [92 × 2]&gt; </span></a>
<a class="sourceLine" id="cb19-15" data-line-number="15"><span class="co">#&gt; 11      1024       1    0    &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb19-16" data-line-number="16"><span class="co">#&gt; 12      1024       1    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb19-17" data-line-number="17"><span class="co">#&gt; 13      1024       1    0.5  &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb19-18" data-line-number="18"><span class="co">#&gt; 14      1024       1    0.75 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="co">#&gt; 15      1024       1    1    &lt;tibble [100 × 2]&gt;</span></a></code></pre></div>
<p>More nested tibbles! Let’s unnest <code>five_star_glmnet$.extracts</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">extracted &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span>five_star_glmnet <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(id, .extracts) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="st">  </span><span class="kw">unnest</span>(<span class="dt">cols =</span> .extracts)</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">extracted</a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="co">#&gt; # A tibble: 150 x 5</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="co">#&gt;    id         num_terms penalty mixture .extracts         </span></a>
<a class="sourceLine" id="cb20-8" data-line-number="8"><span class="co">#&gt;    &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;list&gt;            </span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9"><span class="co">#&gt;  1 Resample01       256       1    0    &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co">#&gt;  2 Resample01       256       1    0.25 &lt;tibble [86 × 2]&gt; </span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11"><span class="co">#&gt;  3 Resample01       256       1    0.5  &lt;tibble [81 × 2]&gt; </span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co">#&gt;  4 Resample01       256       1    0.75 &lt;tibble [80 × 2]&gt; </span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13"><span class="co">#&gt;  5 Resample01       256       1    1    &lt;tibble [79 × 2]&gt; </span></a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="co">#&gt;  6 Resample01       512       1    0    &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="co">#&gt;  7 Resample01       512       1    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb20-16" data-line-number="16"><span class="co">#&gt;  8 Resample01       512       1    0.5  &lt;tibble [99 × 2]&gt; </span></a>
<a class="sourceLine" id="cb20-17" data-line-number="17"><span class="co">#&gt;  9 Resample01       512       1    0.75 &lt;tibble [95 × 2]&gt; </span></a>
<a class="sourceLine" id="cb20-18" data-line-number="18"><span class="co">#&gt; 10 Resample01       512       1    1    &lt;tibble [92 × 2]&gt; </span></a>
<a class="sourceLine" id="cb20-19" data-line-number="19"><span class="co">#&gt; # … with 140 more rows</span></a></code></pre></div>
<p>One thing to realize here is that <code><a href="../../reference/tune_grid.html">tune_grid()</a></code> <a href="optimizations.html">may not fit all of the models</a> that are evaluated. In this case, for each value of <code>mixture</code> and <code>num_terms</code>, the model is fit overall <em>all</em> penalty values<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>. To select the best parameter set, we can exclude the <code>penalty</code> column in <code>extracted</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">extracted &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="st">  </span>extracted <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>penalty) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="st">  </span><span class="kw">inner_join</span>(params, <span class="dt">by =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"num_terms"</span>, <span class="st">"mixture"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="st">  </span><span class="co"># Now remove it from the final results</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>penalty)</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">extracted</a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="co">#&gt; # A tibble: 10 x 4</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="co">#&gt;    id         num_terms mixture .extracts         </span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="co">#&gt;    &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt; &lt;list&gt;            </span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11"><span class="co">#&gt;  1 Resample01      1024    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="co">#&gt;  2 Resample02      1024    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb21-13" data-line-number="13"><span class="co">#&gt;  3 Resample03      1024    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb21-14" data-line-number="14"><span class="co">#&gt;  4 Resample04      1024    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb21-15" data-line-number="15"><span class="co">#&gt;  5 Resample05      1024    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb21-16" data-line-number="16"><span class="co">#&gt;  6 Resample06      1024    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb21-17" data-line-number="17"><span class="co">#&gt;  7 Resample07      1024    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb21-18" data-line-number="18"><span class="co">#&gt;  8 Resample08      1024    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb21-19" data-line-number="19"><span class="co">#&gt;  9 Resample09      1024    0.25 &lt;tibble [100 × 2]&gt;</span></a>
<a class="sourceLine" id="cb21-20" data-line-number="20"><span class="co">#&gt; 10 Resample10      1024    0.25 &lt;tibble [100 × 2]&gt;</span></a></code></pre></div>
<p>Now we can get at the results that we want using another <code>unnest</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">extracted &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="st">  </span>extracted <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>(<span class="dt">col =</span> .extracts) <span class="co"># &lt;- these contain a `penalty` column</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4">extracted</a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="co">#&gt; # A tibble: 1,000 x 5</span></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="co">#&gt;    id         num_terms mixture penalty num_vars</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="co">#&gt;    &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;int&gt;</span></a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">#&gt;  1 Resample01      1024    0.25   0.419        0</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="co">#&gt;  2 Resample01      1024    0.25   0.382        2</span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="co">#&gt;  3 Resample01      1024    0.25   0.348        3</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="co">#&gt;  4 Resample01      1024    0.25   0.317        6</span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="co">#&gt;  5 Resample01      1024    0.25   0.289        7</span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="co">#&gt;  6 Resample01      1024    0.25   0.263        7</span></a>
<a class="sourceLine" id="cb22-14" data-line-number="14"><span class="co">#&gt;  7 Resample01      1024    0.25   0.240       15</span></a>
<a class="sourceLine" id="cb22-15" data-line-number="15"><span class="co">#&gt;  8 Resample01      1024    0.25   0.219       17</span></a>
<a class="sourceLine" id="cb22-16" data-line-number="16"><span class="co">#&gt;  9 Resample01      1024    0.25   0.199       23</span></a>
<a class="sourceLine" id="cb22-17" data-line-number="17"><span class="co">#&gt; 10 Resample01      1024    0.25   0.181       28</span></a>
<a class="sourceLine" id="cb22-18" data-line-number="18"><span class="co">#&gt; # … with 990 more rows</span></a></code></pre></div>
<p>Let’s look at a plot of these results (per resample):</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">ggplot</span>(extracted, <span class="kw">aes</span>(<span class="dt">x =</span> penalty, <span class="dt">y =</span> num_vars)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> id, <span class="dt">col =</span> id), <span class="dt">alpha =</span> <span class="fl">.5</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">"Number of retained predictors"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_x_log10</span>()  <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"mixture = "</span>, params<span class="op">$</span>mixture, <span class="st">"and"</span>, params<span class="op">$</span>num_terms, <span class="st">"features"</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>)</a></code></pre></div>
<p><img src="text_analysis_files/figure-html/var-plot-1.png" width="768"></p>
<p>These results might help guide the range of the <code>penalty</code> value if more optimization was conducted.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>This is a small sample of the overall data set. When more data are used, a larger feature set is optimal. With this small sample, there may not be many more tokens than 256 to include in the hash features.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>See the last section below for more details.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>See the vignette on <a href="../acquisition_functions.html">acquisition functions</a> for more details.<a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>Sorry, pun intended.<a href="#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>This is a feature of this particular model and is not generally true for other engines.<a href="#fnref5" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#recipe-and-model-specifications">Recipe and Model Specifications</a></li>
      <li><a href="#resampling">Resampling</a></li>
      <li><a href="#grid-search">Grid Search</a></li>
      <li><a href="#directed-search">Directed Search</a></li>
      <li><a href="#extracted-results">Extracted Results</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="tidyverse">
  <p>tune is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>




  </body>
</html>
