<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tuning Text Analysis • tune</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><link href="../../tidyverse-2.css" rel="stylesheet">
<!--optional theme--><link href="../../tidymodels.css" rel="stylesheet">
<meta property="og:title" content="Tuning Text Analysis">
<meta property="og:description" content="tune">
<meta property="og:image" content="https://tune.tidymodels.org/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../../index.html">tune</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://tidymodels.org">tidymodels</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../articles/getting_started.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/grid.html">Grid Search</a>
    </li>
    <li>
      <a href="../../articles/acquisition_functions.html">Acquisition Functions</a>
    </li>
    <li>
      <a href="../../articles/extras/svm_classification.html">Bayesian Optimization of Classification Model</a>
    </li>
    <li>
      <a href="../../articles/extras/optimizations.html">Optimizations and Parallel Processing</a>
    </li>
    <li>
      <a href="../../articles/extras/text_analysis.html">Text Analysis Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidymodels/tune/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="text_analysis_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tuning Text Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidymodels/tune/blob/master/vignettes/extras/text_analysis.Rmd"><code>vignettes/extras/text_analysis.Rmd</code></a></small>
      <div class="hidden name"><code>text_analysis.Rmd</code></div>

    </div>

    
    
<p>This advanced example shows how to process text data with recipes and use them in a predictive model. It also has an example of extracting information from each model fit for later use.</p>
<p>The data are from Amazon:</p>
<blockquote>
<p>“This dataset consists of reviews of fine foods from amazon. The data span a period of more than 10 years, including all ~500,000 reviews up to October 2012. Reviews include product and user information, ratings, and a plaintext review.”</p>
</blockquote>
<p>A small subset of the data are contained here; we sampled a single review from 5,000 random products and 80% of these data were used as the training set. The remaining 1,000 were used as the test set.</p>
<p>There is a column for the product, a column for the text of the review, and a factor column for a class variable. The outcome is whether the reviewer game the product a five-star rating or not.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"small_fine_foods"</span><span class="op">)</span>
<span class="va">training_data</span>
<span class="co">#&gt; # A tibble: 4,000 x 3</span>
<span class="co">#&gt;    product    review                                                       score</span>
<span class="co">#&gt;    &lt;chr&gt;      &lt;chr&gt;                                                        &lt;fct&gt;</span>
<span class="co">#&gt;  1 B000J0LSBG "this stuff is  not stuffing  its  not good at all  save yo… other</span>
<span class="co">#&gt;  2 B000EYLDYE "I absolutely LOVE this dried fruit.  LOVE IT.  Whenever I … great</span>
<span class="co">#&gt;  3 B0026LIO9A "GREAT DEAL, CONVENIENT TOO.  Much cheaper than WalMart and… great</span>
<span class="co">#&gt;  4 B00473P8SK "Great flavor, we go through a ton of this sauce! I discove… great</span>
<span class="co">#&gt;  5 B001SAWTNM "This is excellent salsa/hot sauce, but you can get it for … great</span>
<span class="co">#&gt;  6 B000FAG90U "Again, this is the best dogfood out there.  One suggestion… great</span>
<span class="co">#&gt;  7 B006BXTCEK "The box I received was filled with teas, hot chocolates, a… other</span>
<span class="co">#&gt;  8 B002GWH5OY "This is delicious coffee which compares favorably with muc… great</span>
<span class="co">#&gt;  9 B003R0MFYY "Don't let these little tiny cans fool you.  They pack a lo… great</span>
<span class="co">#&gt; 10 B001EO5ZXI "One of the nicest, smoothest cup of chai I've made. Nice m… great</span>
<span class="co">#&gt; # … with 3,990 more rows</span></pre></div>
<p>The idea is to process the text data into features and use these features to predict whether the review was five-star or not.</p>
<div id="recipe-and-model-specifications" class="section level2">
<h2 class="hasAnchor">
<a href="#recipe-and-model-specifications" class="anchor"></a>Recipe and Model Specifications</h2>
<p>The data processing steps are:</p>
<ul>
<li><p>create an initial set of features based on simple word/character scores, such as the number of words, URLs and so on; The <a href="https://github.com/mkearney/textfeatures"><code>textfeatures</code></a> will be used for this</p></li>
<li><p>the text is tokenized (i.e. broken into smaller components such as words)</p></li>
<li><p>stop words (such as “the”, “an”, etc.) are removed</p></li>
<li><p>tokens are stemmed to a common root where possible</p></li>
<li><p>tokens are converted to dummy variables via a <a href="https://bookdown.org/max/FES/encoding-predictors-with-many-categories.html">signed, binary hash function</a></p></li>
<li><p>non-token features are optionally transformed to a more symmetric state using a <a href="https://bookdown.org/max/FES/numeric-one-to-one.html">Yeo-Johnson transformation</a></p></li>
<li><p>predictors with a single distinct value are removed</p></li>
<li><p>all predictors are centered and scaled.</p></li>
</ul>
<p>Some of these steps may or may not be good ideas (such as stemming). In this process, the main tuning parameter will be the number of feature hash features to use.</p>
<p>A recipe will be used to implement this. We’ll also need some helper objects. For example, for the Yeo-Johnson transformation, we need to know the initial feature set:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mkearney/textfeatures">textfeatures</a></span><span class="op">)</span>

<span class="va">basics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu">textfeatures</span><span class="fu">:::</span><span class="va"><a href="https://rdrr.io/pkg/textfeatures/man/count_functions.html">count_functions</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">basics</span><span class="op">)</span>
<span class="co">#&gt; [1] "n_words"    "n_uq_words" "n_charS"    "n_uq_charS" "n_digits"  </span>
<span class="co">#&gt; [6] "n_hashtags"</span></pre></div>
<p>Also, the implementation of feature hashes does not produce binary values. This small function will help convert the scores to values of -1, 0, or 1:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">binary_hash</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span>, <span class="va">x</span><span class="op">)</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span>,  <span class="fl">1</span>, <span class="va">x</span><span class="op">)</span>
  <span class="va">x</span>
<span class="op">}</span></pre></div>
<p>The recipe is:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/textrecipes">textrecipes</a></span><span class="op">)</span>

<span class="va">pre_proc</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">score</span> <span class="op">~</span> <span class="va">product</span> <span class="op">+</span> <span class="va">review</span>, data <span class="op">=</span> <span class="va">training_data</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Do not use the product ID as a predictor</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/roles.html">update_role</a></span><span class="op">(</span><span class="va">product</span>, new_role <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Make a copy of the raw text</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate.html">step_mutate</a></span><span class="op">(</span>review_raw <span class="op">=</span> <span class="va">review</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Compute the initial features. This removes the `review_raw` column</span>
  <span class="fu"><a href="https://textrecipes.tidymodels.org/reference/step_textfeature.html">step_textfeature</a></span><span class="op">(</span><span class="va">review_raw</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Make the feature names shorter</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_rename_at.html">step_rename_at</a></span><span class="op">(</span>
    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"textfeature_"</span><span class="op">)</span>,
    fn <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"textfeature_review_raw_"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://textrecipes.tidymodels.org/reference/step_tokenize.html">step_tokenize</a></span><span class="op">(</span><span class="va">review</span><span class="op">)</span>  <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://textrecipes.tidymodels.org/reference/step_stopwords.html">step_stopwords</a></span><span class="op">(</span><span class="va">review</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://textrecipes.tidymodels.org/reference/step_stem.html">step_stem</a></span><span class="op">(</span><span class="va">review</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Here is where the tuning parameter is declared</span>
  <span class="fu"><a href="https://textrecipes.tidymodels.org/reference/step_texthash.html">step_texthash</a></span><span class="op">(</span><span class="va">review</span>, signed <span class="op">=</span> <span class="cn">TRUE</span>, num_terms <span class="op">=</span> <span class="fu"><a href="../../reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Simplify these names</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_rename_at.html">step_rename_at</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"review_hash"</span><span class="op">)</span>, fn <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"review_"</span>, <span class="st">""</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Convert the features from counts to values of -1, 0, or 1</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"hash"</span><span class="op">)</span>, fn <span class="op">=</span> <span class="va">binary_hash</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="co"># Transform the initial feature set</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_YeoJohnson.html">step_YeoJohnson</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/one_of.html">one_of</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">basics</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_zv.html">step_zv</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_normalize.html">step_normalize</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Note that, when objects from the global environment are used, they are injected into the step objects via <code>!!</code>. For some parallel processing technologies, these objects may not be found by the worker processes.</p>
<p>To model these data, a regularized logistic regression model will be used:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">lr_mod</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/logistic_reg.html">logistic_reg</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="fu"><a href="../../reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span>, mixture <span class="op">=</span> <span class="fu"><a href="../../reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"glmnet"</span><span class="op">)</span></pre></div>
<p>Three tuning parameters should be trained for this data analysis.</p>
</div>
<div id="resampling" class="section level2">
<h2 class="hasAnchor">
<a href="#resampling" class="anchor"></a>Resampling</h2>
<p>There are enough data here such that 10-fold resampling would hold out 400 reviews at a time to estimate performance. Performance estimates using this many observations have sufficiently low noise to measure and tune models.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">8935</span><span class="op">)</span>
<span class="va">folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/vfold_cv.html">vfold_cv</a></span><span class="op">(</span><span class="va">training_data</span><span class="op">)</span></pre></div>
</div>
<div id="grid-search" class="section level2">
<h2 class="hasAnchor">
<a href="#grid-search" class="anchor"></a>Grid Search</h2>
<p>A regular grid is used. For <code>glmnet</code> models, evaluating penalty values is fairly cheap due to the use of the “submodel-trick”. The grid will use 20 penalty values, 5 mixture values, and 3 values for the number of hash features.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">five_star_grid</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
    penalty <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">0</span>, length <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,
    mixture <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,
    num_terms <span class="op">=</span> <span class="fl">2</span><span class="op">^</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">12</span><span class="op">)</span>
  <span class="op">)</span></pre></div>
<p>Note that, for each resample, the text processing recipe is only prepped 6 times. This increases the computational efficiency of the analysis by avoiding redundant work.</p>
<p>For illustration, we will save information on the number of predictors by penalty value for each <code>glmnet</code> model. This might help use understand how many features were used across the penalty values. An extraction function is used to do this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">glmnet_vars</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># `x` will be a workflow object</span>
  <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/extract_recipe.html">extract_model</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="co"># `df` is the number of model terms for each penalty value</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">lambda</span>, num_vars <span class="op">=</span> <span class="va">mod</span><span class="op">$</span><span class="va">df</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/control_grid.html">control_grid</a></span><span class="op">(</span>extract <span class="op">=</span> <span class="va">glmnet_vars</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></pre></div>
<p>Finally, let’s run the grid search:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">roc_scores</span> <span class="op">&lt;-</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">roc_auc</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1559</span><span class="op">)</span>
<span class="va">five_star_glmnet</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../../reference/tune_grid.html">tune_grid</a></span><span class="op">(</span><span class="va">lr_mod</span>, <span class="va">pre_proc</span>, resamples <span class="op">=</span> <span class="va">folds</span>, grid <span class="op">=</span> <span class="va">five_star_grid</span>, 
            metrics <span class="op">=</span> <span class="va">roc_scores</span>, control <span class="op">=</span> <span class="va">ctrl</span><span class="op">)</span>
<span class="co">#&gt; Warning: Duplicate rows in grid of tuning combinations found and removed.</span>
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'Matrix'</span>
<span class="co">#&gt; The following objects are masked from 'package:tidyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     expand, pack, unpack</span>
<span class="co">#&gt; Loaded glmnet 4.0-2</span>
<span class="co">#&gt; i Fold01: recipe 1/3</span>
<span class="co">#&gt; x Fold01: recipe 1/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold01: recipe 2/3</span>
<span class="co">#&gt; x Fold01: recipe 2/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold01: recipe 3/3</span>
<span class="co">#&gt; x Fold01: recipe 3/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold02: recipe 1/3</span>
<span class="co">#&gt; x Fold02: recipe 1/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold02: recipe 2/3</span>
<span class="co">#&gt; x Fold02: recipe 2/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold02: recipe 3/3</span>
<span class="co">#&gt; x Fold02: recipe 3/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold03: recipe 1/3</span>
<span class="co">#&gt; x Fold03: recipe 1/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold03: recipe 2/3</span>
<span class="co">#&gt; x Fold03: recipe 2/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold03: recipe 3/3</span>
<span class="co">#&gt; x Fold03: recipe 3/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold04: recipe 1/3</span>
<span class="co">#&gt; x Fold04: recipe 1/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold04: recipe 2/3</span>
<span class="co">#&gt; x Fold04: recipe 2/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold04: recipe 3/3</span>
<span class="co">#&gt; x Fold04: recipe 3/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold05: recipe 1/3</span>
<span class="co">#&gt; x Fold05: recipe 1/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold05: recipe 2/3</span>
<span class="co">#&gt; x Fold05: recipe 2/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold05: recipe 3/3</span>
<span class="co">#&gt; x Fold05: recipe 3/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold06: recipe 1/3</span>
<span class="co">#&gt; x Fold06: recipe 1/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold06: recipe 2/3</span>
<span class="co">#&gt; x Fold06: recipe 2/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold06: recipe 3/3</span>
<span class="co">#&gt; x Fold06: recipe 3/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold07: recipe 1/3</span>
<span class="co">#&gt; x Fold07: recipe 1/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold07: recipe 2/3</span>
<span class="co">#&gt; x Fold07: recipe 2/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold07: recipe 3/3</span>
<span class="co">#&gt; x Fold07: recipe 3/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold08: recipe 1/3</span>
<span class="co">#&gt; x Fold08: recipe 1/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold08: recipe 2/3</span>
<span class="co">#&gt; x Fold08: recipe 2/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold08: recipe 3/3</span>
<span class="co">#&gt; x Fold08: recipe 3/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold09: recipe 1/3</span>
<span class="co">#&gt; x Fold09: recipe 1/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold09: recipe 2/3</span>
<span class="co">#&gt; x Fold09: recipe 2/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold09: recipe 3/3</span>
<span class="co">#&gt; x Fold09: recipe 3/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold10: recipe 1/3</span>
<span class="co">#&gt; x Fold10: recipe 1/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold10: recipe 2/3</span>
<span class="co">#&gt; x Fold10: recipe 2/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; i Fold10: recipe 3/3</span>
<span class="co">#&gt; x Fold10: recipe 3/3: Error in loadNamespace(name): there is no package called 'st...</span>
<span class="co">#&gt; Warning: All models failed in tune_grid(). See the `.notes` column.</span>

<span class="va">five_star_glmnet</span>
<span class="co">#&gt; Warning: This tuning result has notes. Example notes on model fitting include:</span>
<span class="co">#&gt; recipe 2/3: Error in loadNamespace(name): there is no package called 'stopwords'</span>
<span class="co">#&gt; recipe 1/3: Error in loadNamespace(name): there is no package called 'stopwords'</span>
<span class="co">#&gt; recipe 2/3: Error in loadNamespace(name): there is no package called 'stopwords'</span>
<span class="co">#&gt; # Tuning results</span>
<span class="co">#&gt; # 10-fold cross-validation </span>
<span class="co">#&gt; # A tibble: 10 x 5</span>
<span class="co">#&gt;    splits             id     .metrics .notes           .extracts</span>
<span class="co">#&gt;    &lt;list&gt;             &lt;chr&gt;  &lt;list&gt;   &lt;list&gt;           &lt;list&gt;   </span>
<span class="co">#&gt;  1 &lt;split [3.6K/400]&gt; Fold01 &lt;NULL&gt;   &lt;tibble [3 × 1]&gt; &lt;NULL&gt;   </span>
<span class="co">#&gt;  2 &lt;split [3.6K/400]&gt; Fold02 &lt;NULL&gt;   &lt;tibble [3 × 1]&gt; &lt;NULL&gt;   </span>
<span class="co">#&gt;  3 &lt;split [3.6K/400]&gt; Fold03 &lt;NULL&gt;   &lt;tibble [3 × 1]&gt; &lt;NULL&gt;   </span>
<span class="co">#&gt;  4 &lt;split [3.6K/400]&gt; Fold04 &lt;NULL&gt;   &lt;tibble [3 × 1]&gt; &lt;NULL&gt;   </span>
<span class="co">#&gt;  5 &lt;split [3.6K/400]&gt; Fold05 &lt;NULL&gt;   &lt;tibble [3 × 1]&gt; &lt;NULL&gt;   </span>
<span class="co">#&gt;  6 &lt;split [3.6K/400]&gt; Fold06 &lt;NULL&gt;   &lt;tibble [3 × 1]&gt; &lt;NULL&gt;   </span>
<span class="co">#&gt;  7 &lt;split [3.6K/400]&gt; Fold07 &lt;NULL&gt;   &lt;tibble [3 × 1]&gt; &lt;NULL&gt;   </span>
<span class="co">#&gt;  8 &lt;split [3.6K/400]&gt; Fold08 &lt;NULL&gt;   &lt;tibble [3 × 1]&gt; &lt;NULL&gt;   </span>
<span class="co">#&gt;  9 &lt;split [3.6K/400]&gt; Fold09 &lt;NULL&gt;   &lt;tibble [3 × 1]&gt; &lt;NULL&gt;   </span>
<span class="co">#&gt; 10 &lt;split [3.6K/400]&gt; Fold10 &lt;NULL&gt;   &lt;tibble [3 × 1]&gt; &lt;NULL&gt;</span></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sessioninfo/man/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; ─ Session info ───────────────────────────────────────────────────────────────</span>
<span class="co">#&gt;  setting  value                       </span>
<span class="co">#&gt;  version  R version 4.0.2 (2020-06-22)</span>
<span class="co">#&gt;  os       macOS Catalina 10.15.6      </span>
<span class="co">#&gt;  system   x86_64, darwin17.0          </span>
<span class="co">#&gt;  ui       X11                         </span>
<span class="co">#&gt;  language (EN)                        </span>
<span class="co">#&gt;  collate  en_US.UTF-8                 </span>
<span class="co">#&gt;  ctype    en_US.UTF-8                 </span>
<span class="co">#&gt;  tz       UTC                         </span>
<span class="co">#&gt;  date     2020-10-06                  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ─ Packages ───────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt;  package      * version    date       lib source                               </span>
<span class="co">#&gt;  assertthat     0.2.1      2019-03-21 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  backports      1.1.10     2020-09-15 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  broom        * 0.7.1      2020-10-02 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  class          7.3-17     2020-04-26 [2] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  cli            2.0.2      2020-02-28 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  codetools      0.2-16     2018-12-24 [2] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  colorspace     1.4-1      2019-03-18 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  crayon         1.3.4      2017-09-16 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  desc           1.2.0      2018-05-01 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  dials        * 0.0.9.9000 2020-10-05 [1] Github (tidymodels/dials@2b79300)    </span>
<span class="co">#&gt;  DiceDesign     1.8-1      2019-07-31 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  digest         0.6.25     2020-02-23 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  dplyr        * 1.0.2      2020-08-18 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  ellipsis       0.3.1      2020-05-15 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  evaluate       0.14       2019-05-28 [1] CRAN (R 4.0.1)                       </span>
<span class="co">#&gt;  fansi          0.4.1      2020-01-08 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  foreach        1.5.0      2020-03-30 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  fs             1.5.0      2020-07-31 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  furrr          0.1.0      2018-05-16 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  future         1.19.1     2020-09-22 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  generics       0.0.2      2018-11-29 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  ggplot2      * 3.3.2      2020-06-19 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  glmnet       * 4.0-2      2020-06-16 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  globals        0.13.0     2020-09-17 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  glue           1.4.2      2020-08-27 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  gower          0.2.2      2020-06-23 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  GPfit          1.0-8      2019-02-08 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  gtable         0.3.0      2019-03-25 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  hardhat        0.1.4      2020-07-02 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  htmltools      0.5.0      2020-06-16 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  infer        * 0.5.3      2020-07-14 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  ipred          0.9-9      2019-04-28 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  iterators      1.0.12     2019-07-26 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  knitr          1.30       2020-09-22 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  lattice        0.20-41    2020-04-02 [2] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  lava           1.6.8      2020-09-26 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  lhs            1.1.1      2020-10-05 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  lifecycle      0.2.0      2020-03-06 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  listenv        0.8.0      2019-12-05 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  lubridate      1.7.9      2020-06-08 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  magrittr       1.5        2014-11-22 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  MASS           7.3-51.6   2020-04-26 [2] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  Matrix       * 1.2-18     2019-11-27 [2] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  memoise        1.1.0      2017-04-21 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  modeldata    * 0.0.2      2020-06-22 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  munsell        0.5.0      2018-06-12 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  nnet           7.3-14     2020-04-26 [2] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  parsnip      * 0.1.3      2020-08-04 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  pillar         1.4.6      2020-07-10 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  pkgconfig      2.0.3      2019-09-22 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  pkgdown        1.6.1      2020-09-12 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  plyr           1.8.6      2020-03-03 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  pROC           1.16.2     2020-03-19 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  prodlim        2019.11.13 2019-11-17 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  purrr        * 0.3.4      2020-04-17 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  R6             2.4.1      2019-11-12 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  ragg           0.4.0      2020-10-05 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  Rcpp           1.0.5      2020-07-06 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  recipes      * 0.1.13     2020-06-23 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  rlang          0.4.7      2020-07-09 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  rmarkdown      2.4        2020-09-30 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  rpart          4.1-15     2019-04-12 [2] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  rprojroot      1.3-2      2018-01-03 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  rsample      * 0.0.8.9000 2020-10-05 [1] Github (tidymodels/rsample@ae99c86)  </span>
<span class="co">#&gt;  rstudioapi     0.11       2020-02-07 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  scales       * 1.1.1      2020-05-11 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  sessioninfo    1.1.1      2018-11-05 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  shape          1.4.5      2020-09-13 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  SnowballC      0.7.0      2020-04-01 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  stringi        1.5.3      2020-09-09 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  stringr        1.4.0      2019-02-10 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  survival       3.1-12     2020-04-10 [2] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  systemfonts    0.3.2      2020-09-29 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  textfeatures * 0.3.3      2019-09-03 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  textrecipes  * 0.3.0      2020-07-08 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  textshaping    0.1.1      2020-09-29 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  tibble       * 3.0.3      2020-07-10 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  tidymodels   * 0.1.1      2020-07-14 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  tidyr        * 1.1.2      2020-08-27 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  tidyselect     1.1.0      2020-05-11 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  timeDate       3043.102   2018-02-21 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  tokenizers     0.2.1      2018-03-29 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  tune         * 0.1.1.9000 2020-10-06 [1] local                                </span>
<span class="co">#&gt;  utf8           1.1.4      2018-05-24 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  vctrs          0.3.4      2020-08-29 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  withr          2.3.0      2020-09-22 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  workflows    * 0.2.0.9000 2020-10-05 [1] Github (tidymodels/workflows@40482ae)</span>
<span class="co">#&gt;  xfun           0.18       2020-09-29 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  yaml           2.2.1      2020-02-01 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt;  yardstick    * 0.0.7      2020-07-13 [1] CRAN (R 4.0.2)                       </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [1] /Users/runner/work/_temp/Library</span>
<span class="co">#&gt; [2] /Library/Frameworks/R.framework/Versions/4.0/Resources/library</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/knit_exit.html">knit_exit</a></span><span class="op">(</span><span class="op">)</span></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="tidyverse">
  <p>tune is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
